function [status, res]= makeCAGEM(model_path)

maxima_path= getenv('maxima_path');
if isempty(maxima_path)
    error('Please set path to maxima program via "setenv(''maxima_path'', ''PATH_TO_MAXIMA.EXE'');');
end
cagem_path= getenv('cagem_path');
if isempty(cagem_path)
    error('Please set path to cagem.mac script via "setenv(''cagem_path'', ''PATH_TO_CAMGEM.MAC'');');
end

target_path= strrep(model_path, '.mac', '.m');
command_str= [
    maxima_path, ...
    ' ', ...
    '--batch-string="', ...
    'load("""' strrep(cagem_path, '\', '/') '""")$', ...
    'sys:cagem("""' strrep(model_path, '\', '/') '""")$', ...
    'writeMATLAB("""' strrep(target_path, '\', '/') '""",sys@f,sys@outputs,sys@f_lin)$', ...
    'cagem2c2(sys, """' strrep(target_path, '\', '/') '""")$', ...
    '"'];
[status, res]= system(command_str);
